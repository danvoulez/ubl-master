# v0.4.0-rc1

**Date**: 2026-02-18  
**Tag target**: `15983b4` (recommended RC base)

## Highlights

- Pipeline modularization completed: stage-based runtime (`KNOCK -> WA -> CHECK -> TR -> WF`) with providers and stage modules replacing monolithic orchestration.
- Determinism hardening advanced: expanded property testing and canonical guardrails across `ubl_canon`, `ubl_unc1`, and `ubl_ai_nrf1`.
- Security hardening:
  - CI `KNOCK` output handling fixed.
  - Vulnerable dependencies upgraded (`ring`, `prometheus`, `reqwest` chains).
  - `cargo audit` now passes with warnings only on unmaintained transitive `sled` dependencies.
- UNC-1 strict path reinforced:
  - production run target (`make gate-prod`) enforces `REQUIRE_UNC1_NUMERIC=true` and `F64_IMPORT_MODE=reject`.
  - dedicated CI smoke checks for strict reject/accept cases.
- Ledger boundary improved:
  - `ubl_ledger` public API is no longer no-op.
  - default backend: `ledger_mem`.
  - opt-in backend: `ledger_ndjson` (append-only NDJSON persistence).
- Runtime/WASM execution path remains deterministic with fuel/limits and adapter integrity checks in place.

## Included Changes (concise)

- F4 closed (property tests expanded).
- H6 closed (typed parse boundary in critical pipeline path).
- CI stability fixes for GitHub Actions output contract.
- Dependency security upgrades resolving blocking RustSec advisories.
- Ledger minimum functional implementation + tests.
- UNC-1 strict CI assertions added.

## Operational Notes

- PQ dual-sign (`ML-DSA3`) remains feature-gated stub (`ubl_kms/pq_mldsa3`); Ed25519 remains the production signing path.
- `simkit-stx` CI job is now wired as optional and auto-skips when `simrunner/main.py` is absent.

## Suggested Next Gate Before Final Release

1. Run SimRunner STX in CI with real `simrunner` present and enforce zero failed `receipt.verify`.
2. Add `ledger_ndjson` restart consistency test in CI (`store -> restart -> get`).
3. Decide release tag cut (`v0.4.0-rc1`) after one full green pipeline on this branch head.
